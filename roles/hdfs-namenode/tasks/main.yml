- name: add env config for hadoop
  template: src=templates/hdfs-env.sh dest=/etc/profile.d/ owner=root group=root mode=0644
- name: make env config effect
  shell: "source /etc/profile"

- name: Create HDFS Data DIR and Set Perm
  shell: "mkdir -pv {{ item }} ; chown -Rv hdfs:hdfs {{ item }}"
  with_items:
    - /data/hadoopData/dfs/name
    - /data/hadoopData/tmp/
    - /data/hadoop-3.3.0/logs/

- name: Set hadoop config files
  template: src=templates/{{ item }} dest=/data/hadoop-3.3.0/etc/hadoop/{{ item }} owner=hdfs group=hdfs mode=0644
  with_items:
     - core-site.xml
     - hdfs-site.xml

- name: Set hadoop namenode Services
  template: src=templates/{{ item }} dest=/usr/lib/systemd/system/{{ item }} owner=hdfs group=hdfs mode=0755
  with_items:
    - hdfs-namenode-start.run
    - hdfs-namenode-stop.run
    - hdfs-namenode.service
    - hdfs-zkfc-start.run
    - hdfs-zkfc-stop.run
    - hdfs-zkfc.service

- name:  systemd daemon-reload
  shell: "systemctl daemon-reload"
- name: Start namenode service 
  shell: "systemctl restart hdfs-namenode; systemctl enable hdfs-namenode"
- name: Start zkfc service 
  shell: "systemctl restart hdfs-zkfc; systemctl enable hdfs-zkfc"
